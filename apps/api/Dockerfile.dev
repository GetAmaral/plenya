FROM golang:1.25-alpine

WORKDIR /app

# Instalar dependências do sistema
RUN apk add --no-cache git make \
    # Dependências do Chromium para geração de PDF
    chromium \
    nss \
    freetype \
    harfbuzz \
    ca-certificates \
    ttf-freefont \
    # Dependências para OCR e processamento de PDF
    poppler-utils \
    tesseract-ocr \
    tesseract-ocr-data-por \
    imagemagick

# Copiar entrypoint
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Expor porta
EXPOSE 3001

# Usar entrypoint para rodar go mod tidy antes de iniciar
ENTRYPOINT ["/entrypoint.sh"]
